<div class="transaction-list-card">
  <div class="header-row">
    <div class="title-group">
      <h3 class="title">Movimientos</h3>
      <div class="header-actions">
        <button class="details-link" (click)="onViewDetails()">üîç Ver detalles</button>
        <button class="export-link" (click)="onExport()">üì• Exportar</button>
      </div>
    </div>
    <select [(ngModel)]="categoryFilter" class="category-filter">
      <option value="">Todas</option>
      <option *ngFor="let cat of allCategories" [value]="cat">{{ icons[cat] }} {{ cat }}</option>
    </select>
  </div>

  <div class="filter-summary" *ngIf="categoryFilter()">
    <span class="summary-label">Total en {{ categoryFilter() }}:</span>
    <span class="summary-amount" [class.positive]="filteredTotal() >= 0" [class.negative]="filteredTotal() < 0">
      {{ filteredTotal() | currency:'EUR' }}
    </span>
  </div>

  <div class="list-container">
    <div *ngIf="filteredTransactions().length === 0" class="empty-state">
      <p>No hay movimientos registrados.</p>
    </div>

    <div *ngFor="let transaction of filteredTransactions()" 
         class="transaction-item" 
         (click)="onSelect(transaction)">
      <div class="transaction-icon" [class.income]="transaction.type === 'income'" [class.expense]="transaction.type === 'expense'">
        {{ icons[transaction.category] }}
      </div>
      
      <div class="transaction-details">
        <div class="transaction-header">
          <span class="transaction-title">{{ transaction.title }}</span>
          <span class="transaction-amount" [class.positive]="transaction.type === 'income'" [class.negative]="transaction.type === 'expense'">
            {{ transaction.type === 'income' ? '+' : '-' }}{{ transaction.amount | currency:'EUR' }}
          </span>
        </div>
        <div class="transaction-meta">
          <div class="meta-info">
            <span class="transaction-category">{{ transaction.category }}</span>
            <span class="transaction-date">{{ transaction.date | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="comment-preview" *ngIf="transaction.comment">
            {{ transaction.comment }}
          </div>
        </div>
      </div>

      <button class="delete-btn" (click)="confirmDelete(transaction.id, $event)" title="Eliminar">
        √ó
      </button>
    </div>
  </div>

  <div class="footer-actions">
    <button class="reset-app-btn" (click)="clearAllData()">
      ‚ö†Ô∏è Resetear Aplicaci√≥n
    </button>
  </div>

  <!-- Deletion Confirmation Modal -->
  <div class="confirm-overlay" *ngIf="transactionToDelete()" (click)="cancelDelete()">
    <div class="confirm-modal" (click)="$event.stopPropagation()">
      <div class="confirm-icon">‚ö†Ô∏è</div>
      <h4>¬øEliminar movimiento?</h4>
      <p>Esta acci√≥n no se puede deshacer.</p>
      <div class="confirm-actions">
        <button class="btn-cancel" (click)="cancelDelete()">Cancelar</button>
        <button class="btn-confirm" (click)="executeDelete()">Eliminar</button>
      </div>
    </div>
  </div>
</div>
